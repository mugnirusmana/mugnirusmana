{"ast":null,"code":"import React,{useState,useRef,useEffect}from\"react\";import QrReader from'react-qr-scanner';import{useDispatch,useSelector}from\"react-redux\";import{useNavigate}from\"react-router\";import{getWindowDimensions}from'./../../helper';import{defaultAttenderAttend,submitAttenderAttend}from'./../../redux/attenderAttendSlice';import BreadCrumb from\"../../components/breadcrumb\";import Alert from'../../components/alert';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const ScanQr=()=>{var _attenderAttend$data;const navigate=useNavigate();const dispatch=useDispatch();const[canScan,setCanScan]=useState(true);const[dataScan,setDataScan]=useState('');const[showSuccessAlert,setShowSuccessAlert]=useState(false);const[showErrorsAlert,setShowErrorsAlert]=useState(false);const[errorMessageScan,setErrorMessageScan]=useState('');const[windowDimensions,setWindowDimensions]=useState(getWindowDimensions());const[cameraStyle,setCameraStyle]=useState({width:0,height:0});const attenderAttend=useSelector(_ref=>{let{attenderAttend}=_ref;return attenderAttend;});const ref=useRef();useEffect(()=>{dispatch(defaultAttenderAttend());const handleResize=()=>setWindowDimensions(getWindowDimensions());window.addEventListener('resize',handleResize);return()=>{window.removeEventListener('resize',handleResize);};},[]);useEffect(()=>{if((windowDimensions===null||windowDimensions===void 0?void 0:windowDimensions.width)>0&&(windowDimensions===null||windowDimensions===void 0?void 0:windowDimensions.width)<=639){setCameraStyle({width:150,height:150});}else if((windowDimensions===null||windowDimensions===void 0?void 0:windowDimensions.width)>639){setCameraStyle({width:500,height:500});}},[windowDimensions]);useEffect(()=>{if(dataScan)setAttend();},[dataScan]);useEffect(()=>{let{isLoading,isSuccess,isError,errorMessage}=attenderAttend;if(!isLoading&&isSuccess){setShowSuccessAlert(true);}if(!isLoading&&isError){setErrorMessageScan(errorMessage);setShowErrorsAlert(true);}},[attenderAttend]);const setAttend=()=>{if(!(attenderAttend!==null&&attenderAttend!==void 0&&attenderAttend.isLoading)){dispatch(submitAttenderAttend(dataScan));}};return/*#__PURE__*/_jsxs(\"div\",{className:\"w-full h-full flex flex-col\",children:[/*#__PURE__*/_jsx(BreadCrumb,{title:'Scan Qr',list:[{title:'Scan Qr',path:'',active:true}]}),/*#__PURE__*/_jsxs(\"div\",{ref:ref,className:\"w-full h-fit flex flex-col p-5 rounded shadow-lg gap-5 relative bg-white\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-full h-fit tablet:h-[400px] flex items-center justify-center\",children:/*#__PURE__*/_jsx(QrReader,{delay:5000,style:cameraStyle,onError:error=>{if(canScan){setCanScan(false);setErrorMessageScan(\"Failed scan QR: \".concat(error));setShowErrorsAlert(true);}},onScan:data=>{if(canScan&&data){setCanScan(false);setDataScan(data===null||data===void 0?void 0:data.text);}}})}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col items-center justify-center text-sm tablet:text-xl gap-2 desktop:gap-5\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"flex items-center justify-center text-center\",children:\"Scan your Qr code here\"}),/*#__PURE__*/_jsx(\"div\",{className:\"flex items-center justify-center text-center\",children:\"Or manually sign on a signature book\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-center text-center text-xs\",children:[\"If your can't scan your QR, click\\xA0\",/*#__PURE__*/_jsx(\"span\",{className:\"cursor-pointer font-bold text-sky-500\",onClick:()=>window.location.reload(),children:\"here\"}),\"\\xA0for refresh the page\"]})]})]}),/*#__PURE__*/_jsx(Alert,{show:showSuccessAlert,type:\"success\",title:\"Success\",message:\"Thanks for comming<br><b className=\\\"text-sm\\\">\".concat(attenderAttend===null||attenderAttend===void 0?void 0:(_attenderAttend$data=attenderAttend.data)===null||_attenderAttend$data===void 0?void 0:_attenderAttend$data.name,\"</b><br><span className=\\\"text-xs\\\">Tap confirm to close<span>\"),showCancelButton:false,onConfirm:()=>window.location.reload()}),/*#__PURE__*/_jsx(Alert,{show:showErrorsAlert,type:\"warning\",title:\"Warning\",message:errorMessageScan,showCancelButton:false,onConfirm:()=>{if(errorMessageScan!==null&&errorMessageScan!==void 0&&errorMessageScan.includes('Failed scan QR')){navigate('/dashboard');}else{window.location.reload();}}})]});};export default ScanQr;","map":{"version":3,"names":["React","useState","useRef","useEffect","QrReader","useDispatch","useSelector","useNavigate","getWindowDimensions","defaultAttenderAttend","submitAttenderAttend","BreadCrumb","Alert","jsx","_jsx","jsxs","_jsxs","ScanQr","_attenderAttend$data","navigate","dispatch","canScan","setCanScan","dataScan","setDataScan","showSuccessAlert","setShowSuccessAlert","showErrorsAlert","setShowErrorsAlert","errorMessageScan","setErrorMessageScan","windowDimensions","setWindowDimensions","cameraStyle","setCameraStyle","width","height","attenderAttend","_ref","ref","handleResize","window","addEventListener","removeEventListener","setAttend","isLoading","isSuccess","isError","errorMessage","className","children","title","list","path","active","delay","style","onError","error","concat","onScan","data","text","onClick","location","reload","show","type","message","name","showCancelButton","onConfirm","includes"],"sources":["/var/www/html/fe/src/pages/scan-qr/index.js"],"sourcesContent":["import React, { useState, useRef, useEffect } from \"react\";\nimport QrReader from 'react-qr-scanner';\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { useNavigate } from \"react-router\";\n\nimport { getWindowDimensions } from './../../helper';\n\nimport { defaultAttenderAttend, submitAttenderAttend } from './../../redux/attenderAttendSlice';\n\nimport BreadCrumb from \"../../components/breadcrumb\";\nimport Alert from '../../components/alert';\n\nconst ScanQr = () => {\n  const navigate = useNavigate();\n  const dispatch = useDispatch();\n  const [canScan, setCanScan] = useState(true);\n  const [dataScan, setDataScan] = useState('');\n  const [showSuccessAlert, setShowSuccessAlert] = useState(false);\n  const [showErrorsAlert, setShowErrorsAlert] = useState(false);\n  const [errorMessageScan, setErrorMessageScan] = useState('');\n  const [windowDimensions, setWindowDimensions] = useState(getWindowDimensions());\n  const [cameraStyle, setCameraStyle] = useState({width: 0, height: 0});\n  const attenderAttend = useSelector(({ attenderAttend }) => attenderAttend);\n  const ref = useRef();\n\n  useEffect(() => {\n    dispatch(defaultAttenderAttend());\n    const handleResize = () => setWindowDimensions(getWindowDimensions())\n    window.addEventListener('resize', handleResize);\n\n    return () => {\n      window.removeEventListener('resize', handleResize);\n    }\n  }, []);\n\n  useEffect(() => {\n    if (windowDimensions?.width > 0 && windowDimensions?.width <= 639) {\n      setCameraStyle({width: 150, height: 150});\n    } else if (windowDimensions?.width > 639) {\n      setCameraStyle({width: 500, height: 500});\n    }\n\n  }, [windowDimensions])\n\n  useEffect(() => {\n    if (dataScan) setAttend()\n  }, [dataScan]);\n\n  useEffect(() => {\n    let {\n      isLoading,\n      isSuccess,\n      isError,\n      errorMessage,\n    } = attenderAttend;\n\n    if(!isLoading && isSuccess) {\n      setShowSuccessAlert(true);\n    }\n\n    if(!isLoading && isError) {\n      setErrorMessageScan(errorMessage);\n      setShowErrorsAlert(true);\n    }\n  }, [attenderAttend]);\n\n  const setAttend = () => {\n    if(!attenderAttend?.isLoading) {\n      dispatch(submitAttenderAttend(dataScan));\n    }\n  }\n\n  return (\n    <div className=\"w-full h-full flex flex-col\">\n      <BreadCrumb\n        title={'Scan Qr'}\n        list={[\n          {title: 'Scan Qr', path: '', active: true},\n        ]}\n      />\n\n      <div ref={ref} className=\"w-full h-fit flex flex-col p-5 rounded shadow-lg gap-5 relative bg-white\">\n        \n        <div className=\"w-full h-fit tablet:h-[400px] flex items-center justify-center\">\n          <QrReader\n            delay={5000}\n            style={cameraStyle}\n            onError={(error) => {\n              if (canScan) {\n                setCanScan(false);\n                setErrorMessageScan(`Failed scan QR: ${error}`)\n                setShowErrorsAlert(true);\n              }\n            }}\n            onScan={(data) => {\n              if (canScan && data) {\n                setCanScan(false);\n                setDataScan(data?.text);\n              }\n            }}\n          />\n        </div>\n        <div className=\"flex flex-col items-center justify-center text-sm tablet:text-xl gap-2 desktop:gap-5\">\n          <div className=\"flex items-center justify-center text-center\">Scan your Qr code here</div>\n          <div className=\"flex items-center justify-center text-center\">Or manually sign on a signature book</div>\n          <div className=\"flex items-center justify-center text-center text-xs\">If your can't scan your QR, click&nbsp;<span className=\"cursor-pointer font-bold text-sky-500\" onClick={() => window.location.reload()}>here</span>&nbsp;for refresh the page</div>\n\n        </div>\n      </div>\n\n      <Alert\n        show={showSuccessAlert}\n        type=\"success\"\n        title=\"Success\"\n        message={`Thanks for comming<br><b className=\"text-sm\">${attenderAttend?.data?.name}</b><br><span className=\"text-xs\">Tap confirm to close<span>`}\n        showCancelButton={false}\n        onConfirm={() => window.location.reload()}\n      />\n\n        <Alert\n        show={showErrorsAlert}\n        type=\"warning\"\n        title=\"Warning\"\n        message={errorMessageScan}\n        showCancelButton={false}\n        onConfirm={() => {\n          if (errorMessageScan?.includes('Failed scan QR')) {\n            navigate('/dashboard');\n          } else {\n            window.location.reload();\n          }\n        }}\n      />\n    </div>\n  );\n};\n\nexport default ScanQr;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}